<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>AIDetect - Questionnaire</title>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f9fcff;
            color: #333;
            padding: 20px;
            margin: 0;
        }
        .subpage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: #ffffff;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            border-radius: 12px;
            max-width: 800px;
            margin: auto;
            margin-bottom: 20px;
        }
        .lang-btn {
            font-size: 16px;
            background-color: #007c91;
            color: white;
            border: 1px solid white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
        }
        h1 {
            color: #007c91;
            text-align: center;
            margin: 0;
            font-size: 1.5em;
        }
        form {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: auto;
        }
        .feature-group {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .feature-group h3 {
            color: #007c91;
            margin-top: 0;
            margin-bottom: 0;
            text-align: left;
        }
        .feature-group select, .feature-group label {
            display: block;
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .feature-group select:hover {
            border-color: #007bff;
            box-shadow: 0 0 5px rgba(0,123,255,0.3);
        }
        .feature-group select:focus {
            outline: none;
            border-color: #0056b3;
            box-shadow: 0 0 5px rgba(0,86,179,0.5);
        }
        .feature-group input[type="checkbox"] {
            margin-right: 5px;
        }
        .feature-group label {
            border: none;
            background: none;
            cursor: pointer;
            padding: 5px 0;
            width: fit-content;
        }
        button {
            margin-top: 30px;
            padding: 12px 24px;
            background-color: #007c91;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
        }
        button:hover {
            background-color: #005f73;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        .modal-content h2 {
            color: #007c91;
            margin-top: 0;
        }
        .modal-content p {
            font-size: 18px;
            margin-bottom: 25px;
        }
    </style>
</head>
<body>

<div class="subpage-header">
    <h1 data-translate="pageTitle">Health Information</h1>
    <button id="lang-toggle" class="lang-btn" onclick="toggleLanguage()">TH</button>
</div>

<div id="serverStatus" style="position: fixed;bottom: 20px;right: 20px;background-color: rgba(255,255,255,0.9);padding: 8px 12px;border-radius: 8px;box-shadow: 0 2px 8px rgba(0,0,0,0.2);display: flex;align-items: center;z-index: 9999;">
    <span id="statusLight" style="display:inline-block;width:15px;height:15px;border-radius:50%;background-color:gray;margin-right:8px;"></span>
    <span id="statusText" data-translate="statusChecking">Checking server...</span>
</div>

<form onsubmit="submitForm(event)">
    <div class="feature-group">
        <h3 data-translate="age">Age</h3>
        <select name="age">
            <option value="" data-translate="select">Select...</option>
            <option value="0-1">0-1</option>
            <option value="5-15">5-15</option>
            <option value="10-20">10-20</option>
            <option value="40+">40+</option>
            <option value="45+">45+</option>
            <option value="50+">50+</option>
            <option value="60+">60+</option>
            <option value="65+">65+</option>
        </select>
    </div>

    <div class="feature-group">
        <h3 data-translate="urine">Urine per Day</h3>
        <select name="urine">
            <option value="" data-translate="select">Select...</option>
            <option value="<500">&lt;500</option>
            <option value="<800">&lt;800</option>
            <option value="350-550">350-550</option>
            <option value="800-2000">800-2000</option>
            <option value="2000-3000">2000-3000</option>
            <option value=">2000">&gt;2000</option>
            <option value=">3000">&gt;3000</option>
        </select>
    </div>

    <div class="feature-group">
        <h3 data-translate="bmi">Body Mass Index (BMI)</h3>
        <select name="bmi">
            <option value="" data-translate="select">Select...</option>
            <option value=">=18.5">&gt;=18.5</option>
            <option value=">=25">&gt;=25</option>
            <option value="N/a">N/a</option>
        </select>
    </div>
    
    <div class="feature-group">
        <h3 data-translate="water">Water Intake</h3>
        <select name="water">
            <option value="" data-translate="select">Select...</option>
            <option value="<=2700">&lt;=2700</option>
            <option value=">=3700">&gt;=3700</option>
        </select>
    </div>

    <div class="feature-group">
        <h3 data-translate="bp">Blood Pressure</h3>
        <select name="bp">
            <option value="" data-translate="select">Select...</option>
            <option value="120/80">120/80</option>
            <option value=">130/80">&gt;130/80</option>
            <option value="<130/80">&lt;130/80</option>
            <option value=">=130/80">&gt;=130/80</option>
            <option value=">140/80">&gt;140/80</option>
            <option value="95-145/80">95-145/80</option>
        </select>
    </div>

    <div class="feature-group">
        <h3 data-translate="mass">Mass</h3>
        <select name="mass">
            <option value="" data-translate="select">Select...</option>
            <option value="Mass">Mass</option>
            <option value="Negligible">Negligible</option>
            <option value="Overweight">Overweight</option>
        </select>
    </div>

    <div class="feature-group">
        <h3 data-translate="massChange">Mass Change</h3>
        <select name="massChange">
            <option value="" data-translate="select">Select...</option>
            <option value="M+/-">M+/-</option>
            <option value="M+7Kg">M+7Kg</option>
            <option value="-M+7Kg or 10Kg">-M+7Kg or 10Kg</option>
            <option value="M minus 1Kg">M minus 1Kg</option>
            <option value="M minus 5Kg">M minus 5Kg</option>
            <option value="M minus 10Kg">M minus 10Kg</option>
            <option value="M minus 0.5-1Kg">M minus 0.5-1Kg</option>
            <option value="<M">&lt;M</option>
            <option value="No change">No change</option>
            <option value="Negligible.1">Negligible.1</option>
        </select>
    </div>

    <div class="feature-group">
        <h3 data-translate="gender">Risk Gender</h3>
        <select name="gender">
            <option value="" data-translate="select">Select...</option>
            <option value="Male" data-translate="male">Male</option>
            <option value="Female" data-translate="female">Female</option>
        </select>
    </div>
    
    <div class="feature-group">
        <h3 data-translate="symptoms">Symptoms</h3>
        <label><input type="checkbox" name="symptoms" value="Wheezing"> <span data-translate="wheezing">Wheezing</span></label>
        <label><input type="checkbox" name="symptoms" value="Headache"> <span data-translate="headache">Headache</span></label>
        <label><input type="checkbox" name="symptoms" value="Short Breaths"> <span data-translate="shortBreaths">Short Breaths</span></label>
        <label><input type="checkbox" name="symptoms" value="Rapid Breathing"> <span data-translate="rapidBreathing">Rapid Breathing</span></label>
        <label><input type="checkbox" name="symptoms" value="Anxiety"> <span data-translate="anxiety">Anxiety</span></label>
        <label><input type="checkbox" name="symptoms" value="Urine at Night"> <span data-translate="urineAtNight">Urine at Night</span></label>
        <label><input type="checkbox" name="symptoms" value="Irritability"> <span data-translate="irritability">Irritability</span></label>
        <label><input type="checkbox" name="symptoms" value="Blurred Vision"> <span data-translate="blurredVision">Blurred Vision</span></label>
        <label><input type="checkbox" name="symptoms" value="Slow Healing"> <span data-translate="slowHealing">Slow Healing</span></label>
        <label><input type="checkbox" name="symptoms" value="Dry Mouth"> <span data-translate="dryMouth">Dry Mouth</span></label>
        <label><input type="checkbox" name="symptoms" value="Muscle Aches"> <span data-translate="muscleAches">Muscle Aches</span></label>
        <label><input type="checkbox" name="symptoms" value="Nausea/Vomiting"> <span data-translate="nauseaVomiting">Nausea/Vomiting</span></label>
        <label><input type="checkbox" name="symptoms" value="Insomnia"> <span data-translate="insomnia">Insomnia</span></label>
        <label><input type="checkbox" name="symptoms" value="Chest Pain"> <span data-translate="chestPain">Chest Pain</span></label>
        <label><input type="checkbox" name="symptoms" value="Dizziness"> <span data-translate="dizziness">Dizziness</span></label>
        <label><input type="checkbox" name="symptoms" value="Nosebleeds"> <span data-translate="nosebleeds">Nosebleeds</span></label>
        <label><input type="checkbox" name="symptoms" value="Foamy Urine"> <span data-translate="foamyUrine">Foamy Urine</span></label>
        <label><input type="checkbox" name="symptoms" value="Abdominal Pain"> <span data-translate="abdominalPain">Abdominal Pain</span></label>
        <label><input type="checkbox" name="symptoms" value="Itchy Skin"> <span data-translate="itchySkin">Itchy Skin</span></label>
        <label><input type="checkbox" name="symptoms" value="Dark Urine"> <span data-translate="darkUrine">Dark Urine</span></label>
        <label><input type="checkbox" name="symptoms" value="Bone Pain"> <span data-translate="bonePain">Bone Pain</span></label>
    </div>

    <button type="submit" data-translate="submit">Submit</button>
</form>

<div id="resultModal" class="modal-overlay">
    <div class="modal-content">
        <h2 id="modalTitle"></h2>
        <p id="modalMessage"></p>
        <button onclick="closeModal()" data-translate="modalOk">OK</button>
    </div>
</div>

<script>
    const API_ENDPOINT = "https://aidetect-github-io.onrender.com";

    // --- Translations ---
    const translations = {
        en: {
            pageTitle: "Health Information",
            age: "Age",
            urine: "Urine per Day",
            bmi: "Body Mass Index (BMI)",
            water: "Water Intake",
            bp: "Blood Pressure",
            mass: "Mass",
            massChange: "Mass Change",
            gender: "Risk Gender",
            symptoms: "Symptoms",
            select: "Select...",
            male: "Male",
            female: "Female",
            wheezing: "Wheezing",
            headache: "Headache",
            shortBreaths: "Short Breaths",
            rapidBreathing: "Rapid Breathing",
            anxiety: "Anxiety",
            urineAtNight: "Urine at Night",
            irritability: "Irritability",
            blurredVision: "Blurred Vision",
            slowHealing: "Slow Healing",
            dryMouth: "Dry Mouth",
            muscleAches: "Muscle Aches",
            nauseaVomiting: "Nausea/Vomiting",
            insomnia: "Insomnia",
            chestPain: "Chest Pain",
            dizziness: "Dizziness",
            nosebleeds: "Nosebleeds",
            foamyUrine: "Foamy Urine",
            abdominalPain: "Abdominal Pain",
            itchySkin: "Itchy Skin",
            darkUrine: "Dark Urine",
            bonePain: "Bone Pain",
            submit: "Submit",
            statusChecking: "Checking server...",
            statusOnline: "Online",
            statusWaiting: "Waiting for server...",
            statusError: "Cannot connect to server",
            modalTitleResult: "Analysis Result",
            modalTitleError: "Error",
            modalMessagePrediction: "Predicted Disease: ",
            modalMessageError: "Could not connect to the server or invalid data: ",
            modalOk: "OK"
        },
        th: {
            pageTitle: "ข้อมูลสุขภาพ",
            age: "อายุ",
            urine: "ปัสสาวะต่อวัน",
            bmi: "ดัชนีมวลกาย (BMI)",
            water: "ปริมาณน้ำที่ดื่ม",
            bp: "ความดันโลหิต",
            mass: "มวลร่างกาย",
            massChange: "การเปลี่ยนแปลงของมวลร่างกาย",
            gender: "เพศที่มีความเสี่ยง",
            symptoms: "อาการ",
            select: "เลือก...",
            male: "ชาย",
            female: "หญิง",
            wheezing: "หายใจมีเสียงหวีด",
            headache: "ปวดศีรษะ",
            shortBreaths: "หายใจถี่",
            rapidBreathing: "หายใจเร็ว",
            anxiety: "ความวิตกกังวล",
            urineAtNight: "ปัสสาวะตอนกลางคืน",
            irritability: "หงุดหงิดง่าย",
            blurredVision: "ตาพร่ามัว",
            slowHealing: "แผลหายช้า",
            dryMouth: "ปากแห้ง",
            muscleAches: "ปวดเมื่อยกล้ามเนื้อ",
            nauseaVomiting: "คลื่นไส้/อาเจียน",
            insomnia: "นอนไม่หลับ",
            chestPain: "เจ็บหน้าอก",
            dizziness: "วิงเวียนศีรษะ",
            nosebleeds: "เลือดกำเดาไหล",
            foamyUrine: "ปัสสาวะเป็นฟอง",
            abdominalPain: "ปวดท้อง",
            itchySkin: "ผิวหนังคัน",
            darkUrine: "ปัสสาวะสีเข้ม",
            bonePain: "ปวดกระดูก",
            submit: "ส่งข้อมูล",
            statusChecking: "กำลังตรวจสอบเซิร์ฟเวอร์...",
            statusOnline: "ออนไลน์",
            statusWaiting: "กำลังรอเซิร์ฟเวอร์...",
            statusError: "ไม่สามารถเชื่อมต่อเซิร์ฟเวอร์",
            modalTitleResult: "ผลการวิเคราะห์",
            modalTitleError: "ข้อผิดพลาด",
            modalMessagePrediction: "โรคที่คาดการณ์: ",
            modalMessageError: "ไม่สามารถเชื่อมต่อเซิร์ฟเวอร์หรือข้อมูลไม่ถูกต้อง: ",
            modalOk: "ตกลง"
        }
    };
    
    let currentLang = 'en';
    const langToggleBtn = document.getElementById('lang-toggle');
    const statusText = document.getElementById("statusText");
    const statusLight = document.getElementById("statusLight");
    
    function setLanguage(lang) {
        const elementsToTranslate = document.querySelectorAll('[data-translate]');
        elementsToTranslate.forEach(el => {
            const key = el.getAttribute('data-translate');
            if (translations[lang] && translations[lang][key]) {
                el.innerText = translations[lang][key];
            }
        });

        // Special case for select options without data-translate
        const genderOptions = document.querySelector('select[name="gender"]').options;
        genderOptions[1].innerText = translations[lang].male;
        genderOptions[2].innerText = translations[lang].female;

        // Update button text to show the opposite language
        langToggleBtn.innerText = lang === 'en' ? 'TH' : 'EN';
        currentLang = lang;
        
        // Update server status text after changing language
        checkServerStatus();
    }

    function toggleLanguage() {
        const newLang = currentLang === 'en' ? 'th' : 'en';
        setLanguage(newLang);
    }
    
    function showModal(title, message) {
        const modal = document.getElementById("resultModal");
        document.getElementById("modalTitle").innerText = title;
        document.getElementById("modalMessage").innerText = message;
        modal.classList.add("show");
    }

    function closeModal() {
        const modal = document.getElementById("resultModal");
        modal.classList.remove("show");
    }

    async function checkServerStatus() {
        try {
            const response = await fetch(`${API_ENDPOINT}/api/status`, { method: 'GET' });
            const data = await response.json();

            if (data.status === "online") {
                statusText.innerText = translations[currentLang].statusOnline;
                statusLight.style.backgroundColor = "green";
            } else {
                statusText.innerText = translations[currentLang].statusWaiting;
                statusLight.style.backgroundColor = "orange";
                setTimeout(checkServerStatus, 5000);
            }
        } catch (error) {
            statusText.innerText = translations[currentLang].statusError;
            statusLight.style.backgroundColor = "red";
            console.error("Error fetching server status:", error);
            setTimeout(checkServerStatus, 5000);
        }
    }
    
    async function submitForm(event) {
        event.preventDefault();

        const data62Features = {
            "0-1": 0, "5-15": 0, "10-20": 0, "40+": 0, "45+": 0, "50+": 0, "60+": 0, "65+": 0,
            "<500": 0, "<800": 0, "350-550": 0, "800-2000": 0, "2000-3000": 0, ">2000": 0, ">3000": 0,
            ">=18.5": 0, ">=25": 0, "N/a": 0, "<=2700": 0, ">=3700": 0, "120/80": 0, ">130/80": 0,
            "<130/80": 0, ">=130/80": 0, ">140/80": 0, "95-145/80": 0, "Mass": 0, "Negligible": 0,
            "Overweight": 0, "M+/-": 0, "M+7Kg": 0, "-M+7Kg or 10Kg": 0, "M minus 1Kg": 0,
            "M minus 5Kg": 0, "M minus 10Kg": 0, "M minus 0.5-1Kg": 0, "<M": 0, "No change": 0,
            "Negligible.1": 0, "Male": 0, "Female": 0, "Wheezing": 0, "Headache": 0,
            "Short Breaths": 0, "Rapid Breathing": 0, "Anxiety": 0, "Urine at Night": 0,
            "Irritability": 0, "Blurred Vision": 0, "Slow Healing": 0, "Dry Mouth": 0,
            "Muscle Aches": 0, "Nausea/Vomiting": 0, "Insomnia": 0, "Chest Pain": 0,
            "Dizziness": 0, "Nosebleeds": 0, "Foamy Urine": 0, "Abdominal Pain": 0,
            "Itchy Skin": 0, "Dark Urine": 0, "Bone Pain": 0
        };

        const selects = document.querySelectorAll('select');
        selects.forEach(select => {
            if (select.value && data62Features.hasOwnProperty(select.value)) {
                data62Features[select.value] = 1;
            }
        });

        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
            if (checkbox.checked && data62Features.hasOwnProperty(checkbox.value)) {
                data62Features[checkbox.value] = 1;
            }
        });

        try {
            const response = await fetch("https://aidetect-github-io.onrender.com/predict", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data62Features)
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
            }

            const result = await response.json();
            const predictedDisease = result.prediction;
            const message = translations[currentLang].modalMessagePrediction + predictedDisease;
            showModal(translations[currentLang].modalTitleResult, message);
        } catch (error) {
            const errorMessage = translations[currentLang].modalMessageError + error.message;
            showModal(translations[currentLang].modalTitleError, errorMessage);
            console.error("Error during prediction:", error);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const browserLang = navigator.language.substring(0, 2);
        if (browserLang === 'th') {
            setLanguage('th');
        } else {
            setLanguage('en');
        }
        checkServerStatus();
    });
</script>
</body>
</html>
